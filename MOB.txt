-------------------------
 見ながらお絵描きBASIC
  MOB
   Ver 0.031(暫定版)
   2021/03/10 by Qajin
-------------------------

－はじめに－

DL有難う御座います。
このソフトは通常テキスト入力とグラフィック表示が同居できないMSXで
「テキスト入力しながらグラフィック表示」を可能にしよう、という趣旨の
拡張BASICです。

書庫を解凍したら以下のファイルがある事を確認してください。

	MOB.TXT		このファイル
	MOB.BIN		MOB本体
	MOB8K.BIN	(8K用TAPE版)
	MOB_LDR.BAS	ローダー
	MOB_SMPL.BAS	サンプルプログラム
	MOB.MAC		ソースファイル群
	bsv_hdr.MAC
	bldad_32.MAC
	bldad_8k.MAC
	mk_mob.bat	バイナリ生成用バッチ
	MOB8K.CAS	ディスクなしMSX用のテープイメージ
			(ローダー/本体/サンプル入り)


－インストール方法－

ローダーを実行するか、CLEAR文でD800h以降(8k版はF160h)をマシン語領域として確保してから
本体を直接BLOADで読み込んで実行してください。

	RUN "MOB_LDR.BAS"
または	CLEAR200,&HD800:BLOAD "MOB.BIN",R

MOBがシステムに組み込まれます。
(一応二重インストール対策はしてありますが、念のためCMDOFFを実行してみてから
 インストールしてください)


ー説明ー

所謂"SCREEN1.5"と呼ばれるモードを実現するものです。
MOBがシステムに組み込まれるとプログラム終了時など強制的にグラフィックから
テキスト画面に戻される場面でもテキストに戻らなくなります。
(内部的にBASICだけがテキスト画面に戻っている)
この状態でVRAMを初期化せずにグラフィック系コマンドを実行する事で
「見ながらお絵描き」(グラフィックを表示したままダイレクトにコマンド実行)
が可能になります。
(但し自動でグラフィックモードにはならない為、逐一CMD SCREEN文の実行が必要です 汗)


ーもう少し説明ー

通常、テキスト画面はフォントを固定し表示する文字の方を変えて実現しています。
対してMSXのグラフィック画面(SCREEN2)は表示する文字の方を固定し、フォントの方を
変える事で疑似的に「ビットマップグラフィック」を実現しているのです。
そして画面全体で別々のパターンを表示出来るよう、テキスト画面の3倍のフォント(パターン)を持っています。
この3倍のパターンはそれぞれ画面の上中下の領域に割り当てられています。
なので、この内の一部に通常の文字フォントを設定してしまえば、その部分だけ
テキスト同様の表示や操作が可能になります。
詳しい使い方はコマンド説明を参照してください。


ー速攻で使う場合ー

以下のコマンドで画面上部・中部がグラフィック、下部8行がテキストになります。

  SCREEN 1:SCREEN 2:CMD SCREEN 1:CMD MAX LINE 8,16:CLS:CMD FNT 2

グラフィック命令を使う時はその前に CMD SCREEN 2をマルチステートメントで入れてください。


ー使用法・入門編ー

BLOADでインストールしたら、まずは通常のSCREEN文で画面を初期化します。

  SCREEN 1:SCREEN 2

最初にSCREEN 1を実行しているのはグラフィック画面から強制的に戻される画面が
SCREEN 0だと意図した表示にならないからです。
(強制テキスト復帰は無効化してありますが、VDP表示が消えないだけでBASIC内部は
 テキストに戻る為)

次いでテキストに使いたい領域にフォントを設定します。
(見えなくても入力出来ます)

  CMD FNT 0

これで文字が見えるようになりました。
SCREEN 2でのグラフィック表示用の文字がずらっと並んでいるので消します。

  CLS (または Shift+HOMEキー)

カーソルがグラフィックに使いたい領域まで移動してしまうので、テキスト表示行を
制限します。

  CMD MAX LINE 8

これでグラフィック領域でキーを打って表示が崩れるのを防げます。
どこまでがテキスト領域か分かるよう、ファンクションキー内容を表示してみましょう。

  KEY ON

通常の一番下でなく、上から8行目に表示されたはずです。
ここまでがテキスト、その下がグラフィック領域になります。

適当にグラフィックコマンドを実行してみましょう。
(BASIC内部は自動でグラフィックモードにならない為、逐一CMD SCREEN文が必要です)

  CMD SCREEN 2:CIRCLE(128,128),32

円が表示されたでしょうか?
ひょっとしたら何か破片のようなものが出るだけで、表示が崩れているかもしれません。

その場合はパターンネームテーブルをグラフィック表示用に再設定する事で戻せます。

  CMD DRAW FIELD 1

円の上半分が表示されたはずです。
同様に下領域も再設定します。

  CMD DRAW FIELD 2

これで画面下2/3の領域がグラフィックに使えるようになりました。
グラフィック画面が崩れるのはテキスト画面のCLSがCMD MAXLINEに関係なく24行全てを
クリアしてしまう為なのですが、崩れる度に戻しているのは手間です。
CLSの動作は「先頭から24行」なので、テキスト領域の方をグラフィックより下に置く事で
これを防ぐ事が出来ます。

  CMD MAX LINE 8,16

カーソルが上に残っているように見えますが、実際は下に飛んでいます。
下にはフォントが設定されていないので見えなくなっているのです。
なので、上領域でやったのと同じようにフォントを設定します。

  CMD FNT 2

これで下領域がテキスト状態になりました。
使わなくなった上領域をグラフィック用にしましょう。

  CMD DRAW FIELD 0

また文字がずらっと並びますが、今度はテキストより上なのでCLSでは消せません。
なので、MOBのコマンドで消します。

  CMD CLS 0

これで画面上2/3がグラフィック、下1/3がテキストの状態になりました。
色々グラフィックコマンドを試してみてください。

さて、ここまで領域設定やグラフィックコマンドを色々試してきましたが、
何かテキストの色が変なのに気付いたかもしれません。
これは SCREEN 1と SCREEN 2ではカラーテーブルのサイズや構造が違う為です。
(通常のCOLOR文を実行しても文字色を設定できません)

なので、最後に文字色が変なのを直して終わりとしましょう。

  CMD COLOR 2,15,4

これで通常の文字色と同じになりました。
後はお好きなように色々試してみてください。


●コマンド説明

最低限の機能しか実装していません。
VDPについては各種資料(MSX2テクニカルハンドブック、グラフィックスマル秘伝など)を
参照してください。


[]のパラメーターは省略可能です。

・CMD SCREEN <画面モード>
　BASICのみを指定の画面モードにします。VDPは初期化されません。
　<画面モード>には0～4が指定可能です。
　(MSX1でも4が指定出来てしまいますが正常動作しないので指定しないでください)

・CMD FNT <領域>
　指定領域(0:上部/1:中間/2:下部)のパターンジェネレータテーブルに
　フォントを設定します。
　(BASIC/VDPの状態に拠らず常にSCREEN2として動作します)
　パターンジェネレーターテーブルのアドレスを変更している場合は
　BASE(12)の値も変更してください。

・CMD COLOR <領域>[,[<前景色>][,<背景色>]]
　指定領域のカラーテーブルに指定色を設定します。
　前景色・背景色の省略時は通常のCOLOR文の値が使われます。
　(BASIC/VDPの状態に拠らず常にSCREEN2として動作します)
　カラーテーブルのアドレスを変更している場合は
　BASE(11)の値も変更してください。

・CMD MAX LINE [<行数>][,<オフセット>]
　テキストの表示可能行数と上からのオフセット行数を指定します。
　グラフィックに使っている領域をテキストで壊さない為のコマンドです。
　省略時は行数24、オフセット0です。合計で24以下の値しか指定できません。
　オフセットを指定するとその行数分上からずれた行がテキスト領域になります。
　オフセットは通常のSCREEN文を実行するとリセットされますが、『行数はリセットされません』
　また、このコマンドはSCREEN 0でも機能します。
　LOCATE文の座標系もずれるので注意してください
　(オフセットの行がLOCATE,0になる)

・CMD DRAW FIELD <領域>
　指定領域のパターンネームテーブルを描画用に再設定します。
　(キャラクタ0～255を並べます)
　(BASIC/VDPの状態に拠らず常にSCREEN2として動作します)

・CMD CLS <領域>
　指定領域のパターンジェネレーターテーブルを0クリアします。
　描画に使いたい領域に使ってください。
　(BASIC/VDPの状態に拠らず常にSCREEN2として動作します)
　テキストに使っている領域に使うとフォントがクリアされてしまいますので、
　その時はCMD FNT文で再設定してください。
　通常のCLS文は「現在のBASICの画面モードの」クリアをしますので、
　SCREEN2のまま使用するとフォントが消えます。その時もCMD FNT文で再設定してください。

・CMD OFF
　MOBの常駐を解除します。
　DOSに戻る時等は必ず常駐を解除してからにしてください。


ー更新履歴ー
日付		Ver	内容
2022/05/21	0.032	ドキュメントに超簡易な使い方を追記
2021/03/12	-		ドキュメントに連絡先追記
2021/03/10	0.031	同梱のテープ版のローダーを極力メモリを空けるバージョンに
			差し替え
2021/03/10	0.03	CMD SCREEN文でテキスト(0/1)を指定した時、通常のSCREEN文同様
			復帰する画面モード及び現在の画面桁数(WIDTH値)を
			指定画面のものに変更するよう修正
			8kテープ版作成用にソースを一部分離
			テープ版サンプルのエラー時処理を修正
2021/03/09	0.02	CMD CLS追加
			二重インスト防止のバグ修正
			簡単な使用法を追記
2021/03/08	0.01	公開


連絡先
web: http://www.maroon.dti.ne.jp/qajin/msx/
E_Mail: qajin0@gmail.com
Twitter: @QajinMSX
